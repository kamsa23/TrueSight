package me.kamsa23.trueSight.exploits;

import me.kamsa23.trueSight.managers.ConfigUtil;
import me.kamsa23.trueSight.managers.LogManager;
import org.bukkit.event.Listener;
import org.bukkit.event.EventHandler;
import org.bukkit.event.player.PlayerEditBookEvent;
import org.bukkit.inventory.meta.BookMeta;

public class BookExploitBlocker implements Listener {
    private final int maxPages = ConfigUtil.getPlugin()
            .getConfig().getInt("exploits.BookExploitBlocker.max-pages", 50);
    private final int maxPageLength = ConfigUtil.getPlugin()
            .getConfig().getInt("exploits.BookExploitBlocker.max-page-length", 256);

    @EventHandler
    public void onEditBook(PlayerEditBookEvent event) {
        BookMeta meta = event.getNewBookMeta();
        if (meta.getPages().size() > maxPages) {
            event.setCancelled(true);
            event.getPlayer().sendMessage(ConfigUtil.getMessages()
                    .getString("prefix") + "Book has too many pages.");
            LogManager.log("BookExploitBlocker: blocked " + event.getPlayer().getName()
                    + " (pages=" + meta.getPages().size() + ")");
            return;
        }

        for (String page : meta.getPages()) {
            if (page.length() > maxPageLength) {
                event.setCancelled(true);
                event.getPlayer().sendMessage(ConfigUtil.getMessages()
                        .getString("prefix") + "Page too long.");
                LogManager.log("BookExploitBlocker: blocked " + event.getPlayer().getName()
                        + " (page length=" + page.length() + ")");
                return;
            }
        }
    }
}